!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).DmMD=e()}(this,function(){"use strict";return{elements:function(){function t(t){const e=/^[> ]*(([-*=])[ ]{0,2})\1{1,2}\2[ ]*$/.exec(t.str);return e?{type:"HR"}:null}function e(t){const e=/^(#{1,6}) (.+?)( \1)?$/.exec(t.str);if(!e)return null;const n=e[2];return{type:"H",lvl:e[1].length,fin:function(t){this.items=t(n)}}}function n(t){const e=t.str;if("> "!==e.substr(0,2))return null;t.str=e.substr(2);const n=t.fx();return{type:"QUOTE",items:n?[n]:[],enter:function(t,e,n){const r=t.str,i=">"===r.substr(0,1);if(i||0===t.emptyLines){if(i&&(t.str=r.replace(/^(>\s|>)/,"")),!t.str)return t.resetEmptyLines=!1,t.emptyLines++,this;let e=this.items[this.items.length-1];return e&&e.enter&&(e=e.enter(t,t=>t&&this.items.push(t)||t,n))?e:(e=n())&&this.items.push(e)||e}return null}}}const r=/^> \[!(NOTE|IMPORTANT|WARNING)\]\s*$/;function i(t){const e=r.exec(t.str);if(!e)return null;t.str="> ";const i=n(t),s=i.enter;return i.type="ALERT",i.alert=e[1].toLowerCase(),i.enter=function(t,e,n){return r.test(t.str)?null:s.call(this,t,e,n)},i}const s=/^( {0,3}(\d+[\.]?|#[\.]?) +(.*))$|^( {1,4}(.*))$/,l=/^( {0,3}(-|\+|\*|=) +(.*))$|^( {1,4}(.*))$/;function u(t){const e=/^ {0,3}(\d+[\.]?|-|\+|\*|=|#[\.]?) +(.*)$/.exec(t.str);return e?(t.str=e[2],{type:"-=*+".indexOf(e[1])<0?"OL":"UL",items:[{type:"LI",items:[t.fx()]}],enter:function(t,n,r){const i=t.str,u=("OL"===this.type?s:l).exec(i),o=!u&&/^\s{1,4}/.exec(i);if(u||o){if(u?(t.str=u[3]||u[5],u[2]&&this.items.push({type:"LI",items:[]})):o&&(t.str=i.substr(e[0].length)),!t.str)return t.resetEmptyLines=!1,t.emptyLines++,this;const n=this.items[this.items.length-1];let s=n.items[n.items.length-1];return s&&s.enter&&(s=s.enter(t,t=>t&&n.items.push(t)||t,r))?s:(s=r())&&n.items.push(s)||s}return null}}):null}function o(t){const e=/^```\s*([a-z0-9\-]*)\s*$/i.exec(t.str);if(!e)return null;let n=!0;return{type:"CODEBLOCK",code:e[1],text:"",enter:function(t,e,r){if(!0!==n)return null;const i=t.str;return/^\s*```+\s*$/i.test(i)?n=!1:i&&(this.text+=(this.text&&"\n")+i),this}}}function c(t){return t.str?{type:"P",_text:t.str,enter:function(t,e,n){const r=n();return"P"!==r.type||t.emptyLines>0?e(r):(this._text+="\n"+r._text,this)},fin:function(t){this.items=t(this._text),delete this._text}}:null}function h(t){t("\n")}function p(t){t("[",this.text,"]")}function f(t){const e=this.items;for(let n=0;n<e.length;n++){const r=e[n];"string"==typeof r?t(r):r.toText&&r.toText(t)}}function a(t){return t.str.replace(/`((``|[^`])+)`/g,(e,n)=>t.push({type:"CODE",text:n.replace(/``/g,"`"),toText:p}))}function m(t){return t.str.replace(/\s{2,}\n/g,e=>t.push({type:"BR",toText:h}))}function d(t){return t.str.replace(/\s*\n/g,e=>t.push({type:"BR",toText:h}))}function g(t){return t.str.replace(/(\*\*\*|___)(?=\S)([^\r]*?\S)\1/g,(e,n,r)=>t.push({type:"EM",lvl:3,items:t.parse(r),toText:f})).replace(/(\*\*|__)(?=\S)([^\r]*?\S)\1/g,(e,n,r)=>t.push({type:"EM",lvl:2,items:t.parse(r),toText:f})).replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,(e,n,r)=>t.push({type:"EM",lvl:1,items:t.parse(r),toText:f}))}function x(t){return t.str.replace(/(~~)(?=\S)([^\r]*?\S)\1/g,(e,n,r)=>t.push({type:"DEL",items:t.parse(r)}))}function y(t){return t.str.replace(/(~)(?=\S)([^\r]*?\S)\1/g,(e,n,r)=>t.push({type:"SUB",items:t.parse(r),toText:f})).replace(/<sub>(?=\S)([^\r]*?\S)<\/sub>/g,(e,n)=>t.push({type:"SUB",items:t.parse(n),toText:f})).replace(/(\^)(?=\S)([^\r]*?\S)\1/g,(e,n,r)=>t.push({type:"SUP",items:t.parse(r),toText:f})).replace(/<sup>(?=\S)([^\r]*?\S)<\/sup>/g,(e,n)=>t.push({type:"SUP",items:t.parse(n),toText:f}))}function L(t){return t.str.replace(/<((?=~?\/|\S+([:@]))\S+)>/g,(e,n,r)=>["[",n,"][",t.addUrl(null,"@"===r?"mailto:"+n:n),"]"].join(""))}function E(t){return t.str.replace(/\[([^\]]*)\]\(([^)]+)\)/g,(e,n,r)=>["[",n,"][",t.addUrl(null,r),"]"].join(""))}function b(t){return t.str.replace(/!(!)?\[([^\]]*)\]\[([^\]]+)\]/g,(e,n,r,i)=>t.push({type:"MEDIA",block:"!"===n,urlid:i,items:t.parse(r),toText:f}))}function T(t){return t.str.replace(/\[([^\]]+)\]\[([^\]]+)\]/g,(e,n,r)=>t.push({type:"LINK",urlid:r,items:t.parse(n)}))}function S(t){return t.str.replace(/\s@(([a-z0-9_\-\.]+)\/)?([a-z0-9_\-\.]+)/gi,(e,n,r,i)=>" "+t.push({type:"MENTION",group:r,id:i}))}const O={"(c)":"©️","(TM)":"™️","(R)":"®️","...":"…","--\x3e":"→","<--":"←","<--\x3e":"↔","<==":"⇐","==>":"⇒","<==>":"⇔"};function w(t){return t.str.replace(/(\((c|TM|R)\)|\.\.\.|<(--|==)>|<(--|==)|(--|==)>)/g,(t,e)=>O[e])}t.inline=!1,e.inline=!1,n.inline=!1,i.inline=!1,u.inline=!1,o.inline=!1,c.inline=!1,a.inline=!0,m.inline=!0,d.inline=!0,g.inline=!0,x.inline=!0,y.inline=!0,L.inline=!0,E.inline=!0,b.inline=!0,T.inline=!0,S.inline=!0,w.inline=!0;const I=[t,e,i,n,u,o,c,m,d,a,x,y,L,E,g,b,T,S,w];return I.reduce((t,e)=>e.order=t+100,0),Object.freeze({HR:t,H:e,ALERT:i,QUOTE:n,LIST:u,CODEBLOCK:o,P:c,StandardBR:m,SimpleBR:d,CODE:a,EM:g,DEL:x,SUBSUP:y,MEDIA:b,LINK:T,MENTION:S,EasyLink:L,InlineLink:E,Symbols:w,$ALL:Object.freeze(I),$INLINE:Object.freeze([a,m,d,x,y,L,E,g,b,T,S,w])})}(),parser:function(){function t(t){return null==t||0===t.length}class e{constructor(e,n){this.id=e,n=/\s*(\S*)(\s*(?:(\d+)\*(\d+)?|(?:\*(\d+))))?(?:\s*(?:"([^"]*)"|(\S*)))?/.exec(n),this.url=n[1],this.using=0,this.width=t(n[3])?null:n[3],this.height=t(n[5])?t(n[4])?null:n[4]:n[5],this.title=t(n[6])?t(n[7])?null:n[7]:n[6]}toString(){var t=['url="'+this.url+'"'];return this.width&&t.push('width="'+this.width+'"'),this.height&&t.push('height="'+this.height+'"'),this.title&&t.push('title="'+this.title+'"'),t.join(" ")}}const n=Symbol("Temp txt block");const r=/(\r\n|\r)/g,i=/\t/g,s=/^[ ]+$/gm,l=/\n[ ]*\[([^\]]+)\][ ]?:([^\n]+)/g,u=/([^\n]+)\n([-=])+\n/g;function o(t,e){return t.replace(r,"\n").replace(i,"    ").replace(s,"").replace(l,function(t,n,r){return e(n,r),""}).replace(u,function(t,e,n){return("="==n?"# ":"## ")+e+"\n"})}function c(t,e,n){if(e){t.line=n,t.str=e,t.resetEmptyLines=!0;const r=t.last();r&&r.enter&&r.enter(t,t.add,t.fx)||t.add(t.fx()),t.resetEmptyLines&&(t.emptyLines=0)}else t.emptyLines++;return t}return function(t){const r=String.fromCharCode(0),i={block:[],inline:[]};t&&t.filter(t=>!!t).sort((t,e)=>t.order-e.order).reduce((t,e)=>!0===e.inline?i.inline.push(e):i.block.push(e),null);const s=i.inline.length>0?function(t){const e={};let n=0;const s=t=>{const i=r+n+++r;return e[i]=t,i},l=n=>(function(t,e,n,r,i,s){if(!(t=e.reduce((t,e)=>(t.str=e(t),t),{str:t,push:n,parse:r,addUrl:s}).str))return[];const l=[],u=/\0\d+\0/g;let o,c=0;for(;o=u.exec(t);)c<o.index&&l.push(t.substring(c,o.index)),l.push(i[o[0]]),c=u.lastIndex;c<t.length&&l.push(t.substring(c));return l})(n,i.inline,s,l,e,t);return l}:function(){return t=>t&&[t]||[]},l=i.block.length>0?function(t,e,r){const s=[],l={line:null,str:null,emptyLines:0,last:()=>s[s.length-1],add:t=>t&&s.push(t)||t};return l.fx=(()=>i.block.reduce((t,e)=>t||e(l),null)||function(t){if(!t.str)return null;const e=[t.str];return{[n]:!0,enter:function(t,r,i){const s=i();return s[n]?(e.push(t.str),this):r(s)},fin:function(t){return t(e.join("\n"))}}}(l)),o(t,e).split("\n").reduce(c,l),function t(e,r){for(let i=0;i<e.length;i++){const s=e[i];if(s[n]){const t=s.fin(r);e.splice(i,1,...t)}else s.fin?s.fin(r):s.items&&t(s.items,r),delete s.fin,delete s.enter}}(s,r),s}:function(t,e,n){return n(o(t,e))};return console.log("Markdown parser created with handlers:",i),function(t){const n=performance.now(),r={};let i=0;const u=(t,n)=>(t||(t="#"+i++),r[t]=new e(t,n),t),o=s(u);return{type:"ROOT",items:l(t,u,o),urls:r,srcLen:t.length,parseTime:performance.now()-n+"ms"}}}}(),HTML:function(){const t={"<":"&lt;","&":"&amp;"};function e(t,e,n,r){const i=t.type.toLowerCase();e.html("<",i,">"),t.items.forEach(e.el),e.html("</",i,">")}function n(t,e,r,i){e.html('<div class="alert ',t.alert,'">',i.alertLabel&&i.alertLabel(t.alert)||n.defaultLabels[t.alert]),t.items.forEach(e.el),e.html("</div>")}function r(t,e,n){const r=t.title||e;n.html('<img src="',t.url,'"'),t.width&&n.html(' width="',t.width,'"'),t.height&&n.html(' height="',t.height,'"'),r&&n.html(' title="').t(r).html('"'),n.html(">")}return n.defaultLabels={note:"<label>[i] Note</label>",important:"<label>[!] Important</label>",warning:"<label>[‼] Warning</label>"},Object.freeze({ROOT:function(t,e,n,r){e.html("<article>"),t.items.forEach(e.el),e.html("</article>")},H:function(t,e,n,r){e.html("<h",t.lvl,">"),t.items&&t.items.forEach(e.el),e.html("</h",t.lvl,">")},ALERT:n,QUOTE:function(t,e,n,r){e.html('<div class="',t.type.toLowerCase(),'">'),t.items.forEach(e.el),e.html("</div>")},UL:e,OL:e,LI:e,P:function(t,e,n,r){e.html("<p>"),t.items.forEach(e.el),e.html("</p>")},CODEBLOCK:function(t,e,n,r){const i=r.code&&r.code(t.code,t.text);i?e.html(i):e.html("<pre>").t(t.text).html("</pre>")},HR:function(t,e,n,r){e.html("<hr/>")},CODE:function(t,e,n,r){e.html("<code>"),e.t(t.text),e.html("</code>")},BR:function(t,e,n,r){e.html("<br/>")},EM:function(t,e,n,r){e.html(3===t.lvl?"<b><i>":2===t.lvl?"<b>":"<i>"),t.items.forEach(e.el),e.html(3===t.lvl?"</i></b>":2===t.lvl?"</b>":"</i>")},DEL:function(t,e,n,r){e.html("<del>"),t.items.forEach(e.el),e.html("</del>")},SUB:e,SUP:e,MEDIA:function(t,e,n,i){const s=n[t.urlid]||{using:0,url:"#"};if(s.using++,t.block)e.html('<span class="media">'),r(s,null,e),t.items.forEach(e.el),e.html("</span>");else{const n=[];t.toText((...t)=>n.push(...t)),r(s,n.join(""),e)}},LINK:function(t,e,n,r){const i=n[t.urlid]||{using:0,url:"#"},s=r.linkTarget&&r.linkTarget(i);i.using++,e.html('<a href="',i.url,'"'),i.title&&e.html(' title="').t(i.title).html('"'),s&&e.html(' target="').t(s).html('"'),e.html(">"),t.items.forEach(e.el),e.html("</a>")},MENTION:function(t,e,n,r){r.mention&&!1!==r.mention(t,e)||(e.html('<span class="mention"><span class="icon">@</span>'),t.group&&e.t(t.group).html("/"),e.t(t.id),e.html("</span>"))},render:function(e,n){n||(n={});const r=performance.now(),i=e.urls,s=[],l={t:e=>(s.push(function(e){return e&&e.replace(/[<&]/g,e=>t[e])}(e)),l),html:(...t)=>(s.push(...t),l),el:t=>{"string"==typeof t?l.t(t):(this[t.type]||function(t,e,n,r){e.html('<div class="no-writer"><label>No writer for type=').t(t.type).html("</label>"),t.text&&e.t(t.text),t.items&&t.items.forEach(e.el),e.html("</div>")})(t,l,i,n)}};l.el(e);const u=s.join("");return e.renderTime=performance.now()-r+"ms",e.htmlLen=u.length,u},use:function(t){return t&&Object.freeze(Object.assign({},this,t))||this}})}()}});