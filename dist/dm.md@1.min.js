!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).DmMD=e()}(this,(function(){"use strict";return{elements:function(){function t(t){return/^[> ]*(([-*=])[ ]{0,2})\1{1,2}\2[ ]*$/.exec(t.str)?{type:"HR"}:null}function e(t){const e=/^(#{1,6}) (.+?)( \1)?$/.exec(t.str);if(!e)return null;const n=e[2];return{type:"H",lvl:e[1].length,fin:function(t){this.items=t(n)}}}function n(t){const e=t.str;if(">"!==e[0]||" "!==e[1])return null;t.str=e.substr(2);const n=t.fx();return{type:"QUOTE",items:n?[n]:[],enter:function(t,e,n){const r=t.str,i=">"===r[0];if(i||0===t.emptyLines){if(i&&(t.str=r.substr(" "===r[1]?2:1)),!t.str)return t.resetEmptyLines=!1,t.emptyLines++,this;let e=this.items[this.items.length-1];return e&&e.enter&&(e=e.enter(t,(t=>t&&this.items.push(t)||t),n))?e:(e=n())&&this.items.push(e)||e}return null}}}const r=/^> \[!(NOTE|IMPORTANT|WARNING)\]\s*$/;function i(t){const e=r.exec(t.str);if(!e)return null;t.str="> ";const i=n(t),s=i.enter;return i.type="ALERT",i.alert=e[1].toLowerCase(),i.enter=function(t,e,n){return r.test(t.str)?null:s.call(this,t,e,n)},i}const s=/^( {0,3}(\d+[\.]?|#[\.]?) +(.*))$|^( {1,4}(.*))$/,l=/^( {0,3}(-|\+|\*|=) +(.*))$|^( {1,4}(.*))$/;function o(t){const e=/^ {0,3}(\d+[\.]?|-|\+|\*|=|#[\.]?) +(.*)$/.exec(t.str);return e?(t.str=e[2],{type:"-=*+".indexOf(e[1])<0?"OL":"UL",items:[{type:"LI",items:[t.fx()]}],enter:function(t,n,r){const i=t.str,o=("OL"===this.type?s:l).exec(i),u=!o&&/^\s{1,4}/.exec(i);if(o||u){if(o?(t.str=o[3]||o[5],o[2]&&this.items.push({type:"LI",items:[]})):u&&(t.str=i.substr(e[0].length)),!t.str)return t.resetEmptyLines=!1,t.emptyLines++,this;const n=this.items[this.items.length-1];let s=n.items[n.items.length-1];return s&&s.enter&&(s=s.enter(t,(t=>t&&n.items.push(t)||t),r))?s:(s=r())&&n.items.push(s)||s}return null}}):null}function u(t){if(!/^\|(?:(?:\\\||[^|])+\|)+$/i.exec(t.str))return null;return{type:"TABLE",cols:[],rows:[t.str],enter:function(e,n,r){return/^\|(?:(?:\\\||[^|])+\|)+$/i.exec(e.str)?(this.rows.push(t.str),this):null},fin:function(t){const e=[],n=[];let r=!0,i=0;for(let s=0;s<this.rows.length;s++){const l=this.rows[s].split("|");if(l.shift(),l.pop(),r&&c(l,e)){r=!1;continue}const o=l.reduce(((e,n)=>(e.push({type:r?"TH":"TD",items:t(n)}),e)),[]);i=Math.max(i,o.length),n.push(o)}if(i<e.length)e.splice(i);else for(;e.length<i;)e.push("L");this.cols=e,this.rows=n}}}function c(t,e){const n=[];for(let e=0;e<t.length;e++){const r=/(:)?\-+(:)?/.exec(t[e]);if(!r)return!1;n.push(r[1]&&r[2]?"C":r[2]?"R":"L")}return e.splice(0,0,...n),!0}function h(t){const e=/^```\s*([a-z0-9\-]*)\s*$/i.exec(t.str);if(!e)return null;let n=!0;return{type:"CODEBLOCK",code:e[1],text:"",enter:function(t,e,r){if(!0!==n)return null;const i=t.str;return/^\s*```+\s*$/i.test(i)?n=!1:i&&(this.text+=(this.text&&"\n")+i),this}}}function p(t){return t.str?{type:"P",_text:t.str,enter:function(t,e,n){const r=n();return"P"!==r.type||t.emptyLines>0?e(r):(this._text+="\n"+r._text,this)},fin:function(t){this.items=t(this._text),delete this._text}}:null}function f(t){t("\n")}function a(t){t("[",this.text,"]")}function m(t){const e=this.items;for(let n=0;n<e.length;n++){const r=e[n];"string"==typeof r?t(r):r.toText&&r.toText(t)}}function d(t){return t.str.replace(/`((``|[^`])+)`/g,((e,n)=>t.push({type:"CODE",text:n.replace(/``/g,"`"),toText:a})))}function g(t){return t.str.replace(/\s{2,}\n/g,(e=>t.push({type:"BR",toText:f})))}function x(t){return t.str.replace(/\s*\n/g,(e=>t.push({type:"BR",toText:f})))}function y(t){return t.str.replace(/(\*\*\*|___)(?=\S)([^\r]*?\S)\1/g,((e,n,r)=>t.push({type:"EM",lvl:3,items:t.parse(r),toText:m}))).replace(/(\*\*|__)(?=\S)([^\r]*?\S)\1/g,((e,n,r)=>t.push({type:"EM",lvl:2,items:t.parse(r),toText:m}))).replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,((e,n,r)=>t.push({type:"EM",lvl:1,items:t.parse(r),toText:m})))}function L(t){return t.str.replace(/(~~)(?=\S)([^\r]*?\S)\1/g,((e,n,r)=>t.push({type:"DEL",items:t.parse(r)})))}function E(t){return t.str.replace(/(==)(?=\S)([^\r]*?\S)\1/g,((e,n,r)=>t.push({type:"MARK",items:t.parse(r)})))}function b(t){return t.str.replace(/(~)(?=\S)([^\r]*?\S)\1/g,((e,n,r)=>t.push({type:"SUB",items:t.parse(r),toText:m}))).replace(/<sub>(?=\S)([^\r]*?\S)<\/sub>/g,((e,n)=>t.push({type:"SUB",items:t.parse(n),toText:m}))).replace(/(\^)(?=\S)([^\r]*?\S)\1/g,((e,n,r)=>t.push({type:"SUP",items:t.parse(r),toText:m}))).replace(/<sup>(?=\S)([^\r]*?\S)<\/sup>/g,((e,n)=>t.push({type:"SUP",items:t.parse(n),toText:m})))}function T(t){return t.str.replace(/<((?=~?\/|\S+([:@]))\S+)>/g,((e,n,r)=>["[",n,"][",t.addUrl(null,"@"===r?"mailto:"+n:n),"]"].join("")))}function S(t){return t.str.replace(/\[([^\]]*)\]\(([^)]+)\)/g,((e,n,r)=>["[",n,"][",t.addUrl(null,r),"]"].join("")))}function O(t){return t.str.replace(/!(!)?\[([^\]]*)\]\[([^\]]+)\]/g,((e,n,r,i)=>t.push({type:"MEDIA",block:"!"===n,urlid:i,items:t.parse(r),toText:m})))}function w(t){return t.str.replace(/\[([^\]]+)\]\[([^\]]+)\]/g,((e,n,r)=>t.push({type:"LINK",urlid:r,items:t.parse(n)})))}function M(t){return t.str.replace(/\s@(([a-z0-9_\-\.]+)\/)?([a-z0-9_\-\.]+)/gi,((e,n,r,i)=>" "+t.push({type:"MENTION",group:r,id:i})))}const R={"(c)":"©️","(TM)":"™️","(R)":"®️","...":"…","--\x3e":"→","<--":"←","<--\x3e":"↔","<==":"⇐","==>":"⇒","<==>":"⇔"};function I(t){return t.str.replace(/(\((c|TM|R)\)|\.\.\.|<(--|==)>|<(--|==)|(--|==)>)/g,((t,e)=>R[e]))}t.inline=!1,e.inline=!1,n.inline=!1,i.inline=!1,o.inline=!1,u.inline=!1,h.inline=!1,p.inline=!1,d.inline=!0,g.inline=!0,x.inline=!0,y.inline=!0,L.inline=!0,E.inline=!0,b.inline=!0,T.inline=!0,S.inline=!0,O.inline=!0,w.inline=!0,M.inline=!0,I.inline=!0;const N=[t,e,i,n,o,u,h,p,g,x,d,I,L,E,b,T,S,y,O,w,M];return N.reduce(((t,e)=>e.order=t+100),0),Object.freeze({HR:t,H:e,ALERT:i,QUOTE:n,LIST:o,TABLE:u,CODEBLOCK:h,P:p,StandardBR:g,SimpleBR:x,CODE:d,EM:y,DEL:L,MARK:E,SUBSUP:b,MEDIA:O,LINK:w,MENTION:M,EasyLink:T,InlineLink:S,Symbols:I,$ALL:Object.freeze(N),$COMMON:Object.freeze([t,e,n,o,u,h,p,g,d,L,E,b,T,S,y,O,w]),$INLINE:Object.freeze([d,g,x,L,E,b,T,S,y,O,w,M,I])})}(),parser:function(){function t(t){return null==t||0===t.length}class e{constructor(e,n){this.id=e,n=/\s*(\S*)(\s*(?:(\d+)\*(\d+)?|(?:\*(\d+))))?(?:\s*(?:"([^"]*)"|(\S*)))?/.exec(n),this.url=n[1],this.using=0,this.width=t(n[3])?null:n[3],this.height=t(n[5])?t(n[4])?null:n[4]:n[5],this.title=t(n[6])?t(n[7])?null:n[7]:n[6]}toString(){var t=['url="'+this.url+'"'];return this.width&&t.push('width="'+this.width+'"'),this.height&&t.push('height="'+this.height+'"'),this.title&&t.push('title="'+this.title+'"'),t.join(" ")}}const n=Symbol("Temp txt block");const r=/(\r\n|\r)/g,i=/\t/g,s=/^[ ]+$/gm,l=/\n[ ]*\[([^\]]+)\][ ]?:([^\n]+)/g,o=/([^\n]+)\n([-=])+\n/g;function u(t,e){return t.replace(r,"\n").replace(i,"    ").replace(s,"").replace(l,(function(t,n,r){return e(n,r),""})).replace(o,(function(t,e,n){return("="==n?"# ":"## ")+e+"\n"}))}function c(t,e,n){if(e){t.line=n,t.str=e,t.resetEmptyLines=!0;const r=t.last();r&&r.enter&&r.enter(t,t.add,t.fx)||t.add(t.fx()),t.resetEmptyLines&&(t.emptyLines=0)}else t.emptyLines++;return t}function h(t,e){for(let r=0;r<t.length;r++){const i=t[r];if(i[n]){const n=i.fin(e);t.splice(r,1,...n),r+=n.length-1}else i.fin?i.fin(e):i.items&&h(i.items,e),delete i.fin,delete i.enter}}return function(t){const r=String.fromCharCode(0),i={block:[],inline:[]};t&&t.filter((t=>!!t)).sort(((t,e)=>t.order-e.order)).reduce(((t,e)=>!0===e.inline?i.inline.push(e):i.block.push(e)),null);const s=i.inline.length>0?function(t){const e={};let n=0;const s=t=>{const i=r+n+++r;return e[i]=t,i},l=n=>function(t,e,n,r,i,s){if(!(t=e.reduce(((t,e)=>(t.str=e(t),t)),{str:t,push:n,parse:r,addUrl:s}).str))return[];const l=[],o=/\0\d+\0/g;let u,c=0;for(;u=o.exec(t);)c<u.index&&l.push(t.substring(c,u.index)),l.push(i[u[0]]),c=o.lastIndex;return c<t.length&&l.push(t.substring(c)),l}(n,i.inline,s,l,e,t);return l}:function(){return t=>t&&[t]||[]},l=i.block.length>0?function(t,e,r){const s=[],l={line:null,str:null,emptyLines:0,last:()=>s[s.length-1],add:t=>t&&s.push(t)||t};return l.fx=()=>i.block.reduce(((t,e)=>t||e(l)),null)||function(t){if(!t.str)return null;const e=[t.str];return{[n]:!0,enter:function(t,r,i){const s=i();return s[n]?(e.push(t.str),this):r(s)},fin:function(t){return t(e.join("\n"))}}}(l),u(t,e).split("\n").reduce(c,l),h(s,r),s}:function(t,e,n){return n(u(t,e))};return console.log("Markdown parser created with handlers:",i),function(t){const n=performance.now(),r={};let i=0;const o=(t,n)=>(t||(t="#"+i++),r[t]=new e(t,n),t),u=s(o);return{type:"ROOT",items:l(t,o,u),urls:r,srcLen:t.length,parseTime:performance.now()-n+"ms"}}}}(),HTML:function(){function t(t,e,n,r){"string"==typeof t?e.t(t):(e.html('<div class="no-writer"><label>No writer for type=').t(t.type).html("</label>"),t.text&&e.t(t.text),t.items&&t.items.forEach(e.el),e.html("</div>"))}const e={"<":"&lt;","&":"&amp;"};function n(t){return t&&t.toString().replace(/[<&]/g,(t=>e[t]))}function r(t,e,n,r){const i=t.type.toLowerCase();e.html("<",i,">"),t.items.forEach(e.el),e.html("</",i,">")}function i(t,e,n,r){e.html('<div class="alert ',t.alert,'">',r.alertLabel&&("function"==typeof r.alertLabel&&r.alertLabel(t.alert)||r.alertLabel[t.alert])||i.defaultLabels[t.alert]),t.items.forEach(e.el),e.html("</div>")}function s(t,e,n){const r=t.title||e;n.html('<img src="',t.url,'"'),t.width&&n.html(' width="',t.width,'"'),t.height&&n.html(' height="',t.height,'"'),r&&n.html(' title="').t(r).html('"'),n.html(">")}return i.defaultLabels={note:"<label>[i] Note</label>",important:"<label>[!] Important</label>",warning:"<label>[‼] Warning</label>"},Object.freeze({ROOT:function(t,e,n,r){e.html("<article>"),t.items.forEach(e.el),e.html("</article>")},H:function(t,e,n,r){e.html("<h",t.lvl,">"),t.items&&t.items.forEach(e.el),e.html("</h",t.lvl,">")},ALERT:i,QUOTE:function(t,e,n,r){e.html("<blockquote>"),t.items.forEach(e.el),e.html("</blockquote>")},UL:r,OL:r,LI:r,P:function(t,e,n,r){e.html("<p>"),t.items.forEach(e.el),e.html("</p>")},TABLE:function(t,e,n,r){e.html('<div class="scroll-container"><table><colgroup>');const i=t.cols.map((t=>"R"===t?' class="ta-r"':"C"===t?' class="ta-c"':""));t.rows.forEach((t=>{e.html("<tr>"),t.forEach(((t,n)=>{"TH"===t.type?(e.html("<th>"),t.items.forEach(e.el),e.html("</th>")):(e.html("<td",i[n]||"",">"),t.items.forEach(e.el),e.html("</td>"))})),e.html("</tr>")})),e.html("</table></div>")},CODEBLOCK:function(t,e,n,r){const i=r.code&&r.code(t.code,t.text);i?e.html(i):e.html("<pre>").t(t.text).html("</pre>")},HR:function(t,e,n,r){e.html("<hr/>")},CODE:function(t,e,n,r){e.html("<code>"),e.t(t.text),e.html("</code>")},BR:function(t,e,n,r){e.html("<br/>")},EM:function(t,e,n,r){e.html(3===t.lvl?"<b><i>":2===t.lvl?"<b>":"<i>"),t.items.forEach(e.el),e.html(3===t.lvl?"</i></b>":2===t.lvl?"</b>":"</i>")},DEL:r,MARK:r,SUB:r,SUP:r,MEDIA:function(t,e,n,r){const i=n[t.urlid]||{using:0,url:"#"};if(i.using++,t.block)e.html('<span class="media">'),s(i,null,e),t.items.forEach(e.el),e.html("</span>");else{const n=[];t.toText(((...t)=>n.push(...t))),s(i,n.join(""),e)}},LINK:function(t,e,n,r){const i=n[t.urlid]||{using:0,url:"#"},s=r.linkTarget&&r.linkTarget(i);i.using++,e.html('<a href="',i.url,'"'),i.title&&e.html(' title="').t(i.title).html('"');s&&e.html(' target="').t(s).html('"');e.html(">"),t.items.forEach(e.el),e.html("</a>")},MENTION:function(t,e,n,r){if(r.mention&&!1!==r.mention(t,e))return;e.html('<span class="mention"><span class="icon">@</span>'),t.group&&e.t(t.group).html("/");e.t(t.id),e.html("</span>")},render:function(e,r){r||(r={});const i=performance.now(),s=e.urls,l=[],o={t:t=>(l.push(n(t)),o),html:(...t)=>(l.push(...t),o),el:e=>{(this[e.type]||t)(e,o,s,r)}};o.el(e);const u=l.join("");return e.renderTime=performance.now()-i+"ms",e.htmlLen=u.length,u},use:function(t){return t&&Object.freeze(Object.assign({},this,t))||this}})}()}}));